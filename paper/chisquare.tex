\documentclass{amsart}
\title{Title of Document}
\author{Name of Author}

\usepackage{algpseudocode}
%\usepackage{algorithmic}
\usepackage{algorithm}
\usepackage{macros}

\begin{document}
\maketitle


\section{$\chi^2$ test for uniform distribution}

We briefly recall the property and usage of the $\chi^2$ test for uniform distributions over a finite set $S$.

Suppose  $M$ samples $y_1, \cdots, y_M \in S$. We partition $S$ into $r$ subsets
\[
    S = \sqcup_{j=1}^r S_i,
\]
For each $1 \leq j \leq r$, we compute the expected number of samples that would fall in the i-th subset: $c_j := |S_j|M/|S|$. Then we compute the actual number of samples, $t_j := |\{1 \leq i \leq r: y_i \in S_j\}|$. Finally, the $\chi^2$ value is computed as
\[
    \chi^2(S,y) = \sum_{j = 1}^r \frac{(t_j -c_j)^2}{c_j}.
\]
Note that degree of freedom in this test is $d = r-1$.
To decide whether the samples are from a uniform distribtuion, we can either look up a table of $\chi^2$ values, or use an approximation rule:  when $df$ is large, the $\chi^2$ distribution can be well-approximated by a normal distribution $N(d, 2d)$; for example, if it turns out that $\chi^2 \notin (d - c \sqrt{2d}, d+ c \sqrt{2d})$, then the confidence we have that the samples are not taken from a uniform distribution is
$2\Phi(c) - 1$.

\section{Attack}


Now we describe our attack. It relies on the assumption that there exists a prime ideal $\fq$ such that error $e \pmod {\fq}$ is not uniformly distributed in the finite field $F = R/\fq R$. The attack loop through all $q^f$ possitbilities of $\bar{s} = s \pmod{\fq}$. For each guess $s'$, it computes the values $\bar{e}' = \bar{b} - \bar{a} s' \pmod {\fq}$. If the guess is wrong, or if the samples are taken from the uniform distirbution instead of an RLWE instance, then $\bar{e}'$ is uniformly distributed in $F$ and it would pass the $\chi^2$ test. On the other hand, if the guess is correct, then we expect the errors $\bar{e}'$ to fail the $\chi^2$ test.

Let $N = q^f$, the number of $\chi^2$ tests we run in the attack. For the attack to be successful, we need the $(N-1)$ tests corresponding to wrong guess of $s \pmod{\fq}$ to pass, and the one test corresponding to the correct guess to fail. Therefore, we need to choose the confidence interval of our $\chi^2$ test so that it is unlikely for a set of samples coming from uniform distribution to fail the test. In practice, we choose the confidence level to be  $\alpha = 1 - \frac{1}{10N}$. Let $\beta$ denote the probability that the sample errors fails the uniform test with probability  Then the probability that our algorithm will success is $p  = (1- \frac{1}{10N})^{N-1} \beta$. Note that when $N$ is large, $(1- \frac{1}{10N})^{N-1}$ is about $e^{-1/10} \approx 0.904$.








%Note that although we restrict ourselves to subfields of cyclotomics with odd and square-free $m$, the attack could be applied to any finite extension of $\bQ$.

\begin{algorithm}[H]
\caption{$\chi^2$-test attack of RLWE(R,$\fq$)}          % give the algorithm a caption
\label{IPR}                           % and a label for \ref{} commands later in the document
\begin{algorithmic}[1]              % enter the algorithmic environment
     \Require

     %$A_{\bf a}$: the embedding matrix, where ${\bf a}$ is a basis for the ring of integers $\cO_K$ of some number field $K/\bQ$.
     $R = (K,q,\sigma)$ -- an RLWE instance.

     $R = \cO_K$ -- the ring of integers of $K$.

     $n$: the degree of $K$.

     $\fq$: a prime ideal in $K$ above $q$.

     $N$: the cardinality of the finite field $R/\fq$.

     $S$: a collection of $M$ ($M = \Omega(N)$) RLWE samples $(a,b) \sim R$.  %sampled from $D_{\Lambda,s}$, where $\Lambda = Col.span({A_{\bf a}})$, and $s = \sqrt{2 \pi} |\det(A_{\bf a})|^{\frac{1}{n}}\sigma_0$.
    \Ensure a guess of the value $s \pmod{\fq}$, or {\bf NON-RLWE}, or {\bf INSUFFIICNET-SAMPLES}

    %\State $B \gets select_bins(M, |F|)$.

    \State $\alpha \gets 1 - \frac{1}{10N}$.

    \State $\omega \gets \Phi^{-1}((1+\alpha)/2)$

    \State $G = \emptyset$

    \For{$s$ in $F$}
        \For{$a,b$ in $S$}
            \State $E \gets \emptyset$.
            \State $\bar{a}, \bar{b} \gets a \pmod{\fq}, b \pmod{\fq}$.
            \State $\bar{e} \gets \bar{b} - \bar{a}s$.
            \State add $e$ to $E$.
        \EndFor

        \State Run $\chi^2$ test on $E$ and obtain the value $\chi^2(E)$.
        \If{$|\chi^2(E) - B-1| > \omega \sqrt{2B-2}$}
            \State add $s$ to $G$
        \EndIf
    \EndFor
    \If{$G = \emptyset$}

        \Return {\bf NOT RLWE}
    \ElsIf{$G = \{g\}$}

        \Return $g$
    \Else

        \Return {\bf INSUFFIICNET-SAMPLES}
    \EndIf

\end{algorithmic}
\end{algorithm}


Proof of correctness.
\begin{Prop}
The algorithm has time complexity $O(q^{2f})$. Let $\Delta$ be the statistical distance between $D_{R, \sigma} \pmod{\fq}$ and the uniform distribtuion on $R/\fq$. Then algorithm outputs with proability at least $0.904 \Delta$(fixme: do the correct constant).
\end{Prop}
\end{document}
